#include <sys/types.h>
#include <dirent.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <sys/stat.h>
#include <pwd.h>
#include <grp.h>
#include <time.h>

typedef struct s_ls
{
	struct s_ls *next;
	char *filename;
	char *user;
	char *group;
	char *time;
	nlink_t	nlink;
	off_t size;
	char mode[12];
	
}				t_ls;


// char *stat_time(time_t st_mtime)
// {
// 	return (ctime(&st_mtime));
// }

t_ls		*ft_create_elem(void *data)
{
	t_ls	*tmp;
	struct stat stat;
	if (!(tmp = (t_ls *)malloc(sizeof(t_ls))))
		return (NULL);
	tmp->filename = data;
	lstat(data, &stat);
	stat_mode(tmp->mode, stat.st_mode, stat.)
	tmp->user = getpwuid(stat.st_uid)->pw_name;
	tmp->group = getgrgid(stat.st_gid)->gr_name;
	tmp->nlink = stat.st_nlink;
	tmp->size = stat.st_size;
	tmp->time = stat.;
	tmp->next = NULL;
	return (tmp);
}
void	create_linklist(t_ls **begin_list, void *data)
{
	t_ls	*list;

	list = *begin_list;
	if (list)
	{
		while (list->next)
			list = list->next;
		list->next = ft_create_elem(data);
	}
	else
		*begin_list = ft_create_elem(data);
}
void	print_ls(t_ls *ls)
{
	while(ls)
	{
		puts(ls->filename);
		puts(ls->user);
		puts(ls->group);
		printf("%hu\n", ls->nlink);
		printf("%lld\n", ls->size);
		ls = ls->next;
	}
}


int	main(int ar, char **av)
{
	DIR *dir;
	struct dirent *ptr;
	t_ls	*ls;

	dir = opendir(".");
	while((ptr = readdir(dir)) > 0)
	{
		create_linklist(&ls, strdup(ptr->d_name));
	}
	print_ls(ls);
	closedir(dir);
}
